<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>t-test in Bayesian World | Python for Process Innovation</title>
    <meta name="description" content="빈도주의 t-test에 대해 간략히 되새겨 보고, 파이썬에서 베이지안 t-test를 pymc3를 이용해 구현하는 방법에 대해 정리 해 보았습니다.">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/assets/css/0.styles.a134bda1.css" as="style"><link rel="preload" href="/assets/js/app.cbae415f.js" as="script"><link rel="preload" href="/assets/js/3.aaca8d00.js" as="script"><link rel="preload" href="/assets/js/22.e4efa8b6.js" as="script"><link rel="prefetch" href="/assets/js/1.e3bfa02a.js"><link rel="prefetch" href="/assets/js/10.2c2e60c5.js"><link rel="prefetch" href="/assets/js/11.6a2083e9.js"><link rel="prefetch" href="/assets/js/12.bd920b11.js"><link rel="prefetch" href="/assets/js/13.96e0d6fa.js"><link rel="prefetch" href="/assets/js/14.34fb7b1d.js"><link rel="prefetch" href="/assets/js/15.0147dcd6.js"><link rel="prefetch" href="/assets/js/16.39351d19.js"><link rel="prefetch" href="/assets/js/17.1b6c10b7.js"><link rel="prefetch" href="/assets/js/18.b4a97ad2.js"><link rel="prefetch" href="/assets/js/19.c9be2942.js"><link rel="prefetch" href="/assets/js/20.bb23b3c9.js"><link rel="prefetch" href="/assets/js/21.fd38776d.js"><link rel="prefetch" href="/assets/js/23.966fa64f.js"><link rel="prefetch" href="/assets/js/24.f365213e.js"><link rel="prefetch" href="/assets/js/4.8afc31c3.js"><link rel="prefetch" href="/assets/js/5.33f50ecc.js"><link rel="prefetch" href="/assets/js/6.04a27dc0.js"><link rel="prefetch" href="/assets/js/7.07ea371c.js"><link rel="prefetch" href="/assets/js/8.d7a6d9af.js"><link rel="prefetch" href="/assets/js/9.eedbc95d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a134bda1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="layout" data-v-593c3a53><div data-app="true" id="main" class="application theme--light" data-v-593c3a53><div class="application--wrap"><div class="flex white" data-v-593c3a53><nav class="#EEEEEE v-toolbar v-toolbar--card theme--light" style="margin-top:0px;padding-right:0px;padding-left:0px;transform:translateY(0px);" data-v-593c3a53><div class="v-toolbar__content" style="height:56px;"><div class="v-toolbar__title" data-v-593c3a53>su79eu7k</div> <div class="spacer" data-v-593c3a53></div> <div class="v-toolbar__items" data-v-593c3a53><a href="/" class="v-btn v-btn--flat theme--light" data-v-593c3a53><div class="v-btn__content">Home</div></a> <a href="/blog/" class="v-btn v-btn--flat theme--light" data-v-593c3a53><div class="v-btn__content">Blog</div></a></div></div></nav> <div dark="" class="v-parallax" style="height:500px;" data-v-593c3a53><div class="v-parallax__image-container"><img src="https://cdn.vuetifyjs.com/images/backgrounds/vbanner.jpg" alt="" class="v-parallax__image" style="display:block;opacity:0;transform:translate(-50%, 0px);"></div><div class="v-parallax__content"><div class="layout align-center column justify-center" data-v-593c3a53><div class="display-2 font-weight-bold mb-3" data-v-593c3a53>Python for Process Innovation</div> <div class="subheading" data-v-593c3a53>#Python, #Javascript, #SAP, #Automation, #ML, #AI</div></div></div></div> <div id="blog" data-v-0c44d7b6 data-v-593c3a53><div class="layout justify-center" data-v-0c44d7b6 data-v-0c44d7b6><div class="flex xs12 sm10 md10 lg8 xl8" data-v-0c44d7b6 data-v-0c44d7b6><div class="layout column" data-v-41180823 data-v-41180823 data-v-0c44d7b6><div class="flex mx-3 mt-4 mb-2" data-v-41180823 data-v-41180823><div class="display-2 font-weight-bold" data-v-41180823>t-test in Bayesian World</div> <div class="body-1" data-v-41180823>
            Tags:
            
                #<a data-v-41180823>Statistics</a>
                #<a data-v-41180823>Bayesian</a>
                #<a data-v-41180823>Statsmodels</a>
                #<a data-v-41180823>Scipy</a>
                #<a data-v-41180823>PyMC3</a></div> <div class="body-1" data-v-41180823>Update: 2019-01-01</div></div> <!----></div> <div class="content default" data-v-0c44d7b6><h2 id="목차"><a href="#목차" aria-hidden="true" class="header-anchor">#</a> 목차</h2> <p></p><div class="table-of-contents"><ul><li><a href="#목차">목차</a></li><li><a href="#데이터-준비">데이터 준비</a></li><li><a href="#빈도주의-t-검정">빈도주의 t-검정</a><ul><li><a href="#독립표본-t-검정">독립표본 t-검정</a><ul><li><a href="#독립성">독립성</a></li><li><a href="#정규성">정규성</a></li><li><a href="#등분산성">등분산성</a></li></ul></li><li><a href="#대응표본-t-검정">대응표본 t-검정</a><ul><li><a href="#정규성-검정">정규성 검정</a></li></ul></li></ul></li><li><a href="#베이지안-t-검정">베이지안 t-검정</a><ul><li><a href="#베이지안-데이터-분석">베이지안 데이터 분석</a></li><li><a href="#독립표본-t-검정">독립표본 t-검정</a></li></ul></li></ul></div><p></p> <h2 id="데이터-준비"><a href="#데이터-준비" aria-hidden="true" class="header-anchor">#</a> 데이터 준비</h2> <p>한 집단의 평균값과 다른 집단의 평균값의 차이가 명백하다는 점을 최대한 과학적인 방법으로 누군가에게 납득시켜야 할 때가 있습니다.
아래에서는 빈도주의자(Frequentist)의 관점과 베이지안(Bayesian)의 과점에서 t-검정을 수행하는 방법을 살펴보고자 합니다.</p> <p>데이터는 Kruschke, John. (2012) Bayesian estimation supersedes the t-test의 자료를 사용하도록 하겠습니다. 참고로 아래 데이터 준비 코드와 베이지안 t-검정 항목의 코드는 pymc3 튜토리얼의 코드를 참고했습니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>drug <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">95</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">106</span><span class="token punctuation">,</span>
        <span class="token number">109</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">82</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span>
        <span class="token number">96</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">124</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">]</span>
placebo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">88</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span>
           <span class="token number">104</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span>
           <span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">]</span>

y1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>drug<span class="token punctuation">)</span>
y2 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>placebo<span class="token punctuation">)</span>
y <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>value<span class="token operator">=</span>np<span class="token punctuation">.</span>r_<span class="token punctuation">[</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">,</span> group<span class="token operator">=</span>np<span class="token punctuation">.</span>r_<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'drug'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>drug<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'placebo'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>placebo<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="빈도주의-t-검정"><a href="#빈도주의-t-검정" aria-hidden="true" class="header-anchor">#</a> 빈도주의 t-검정</h2> <p>통계학 공부를 하며 접했던 다양한 자료들을 오랜만에 다시 찾아보고 나름대로 아래와 같이 정리를 해보았습니다.</p> <div class="tip custom-block"><p class="custom-block-title">t-검정(t-test)</p> <p>종속변수가 연속형이고 독립변수는 단독 범주형일 때 2개의 서로 다른 수준에 대해 짝을 이루지 않거나(독립표본 t-검정), 짝을 이루는(대응표본 t-검정) 표본들이 기본 가정(독립표본 t-검정의 경우 독립성/정규성/등분산성, 대응표본 t-검정의 경우 정규성)을 만족한다는 조건 하에 각각의 수준들이 유의적인 차이를 보이는지를 검정.</p></div> <h3 id="독립표본-t-검정"><a href="#독립표본-t-검정" aria-hidden="true" class="header-anchor">#</a> 독립표본 t-검정</h3> <h4 id="독립성"><a href="#독립성" aria-hidden="true" class="header-anchor">#</a> 독립성</h4> <p>독립변수에 따른 종속변수가 각 수준별로 짝을 이루고 있지 않아야 한다는 조건입니다(예를 들어 A 투약전/투약후, B 투약전/투약후...가 아닌 투약군 AB.../미투약군 CD...인 경우).</p> <h4 id="정규성"><a href="#정규성" aria-hidden="true" class="header-anchor">#</a> 정규성</h4> <p>독립변수에 따른 종속변수는 정규분포를 만족해야 한다는 조건입니다. 주로 콜모고로프-스미노프(Kolmogorov-Smirnov) 검정을 통해 이를 밝혀내며, 파이썬에서는 statsmodels의 <a href="https://www.statsmodels.org/dev/generated/statsmodels.stats.diagnostic.kstest_normal.html" target="_blank" rel="noopener noreferrer">statsmodels.stats.diagnostic.kstest_normal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 메소드를 사용할 수 있습니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>sm<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>diagnostic<span class="token punctuation">.</span>kstest_normal<span class="token punctuation">(</span>drug <span class="token operator">+</span> placebo<span class="token punctuation">,</span> dist<span class="token operator">=</span><span class="token string">'norm'</span><span class="token punctuation">,</span> pvalmethod<span class="token operator">=</span><span class="token string">'approx'</span><span class="token punctuation">)</span>

<span class="token comment"># (0.22204128505832343, 9.700938640868548e-12)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>콜모고로프-스미노프 검정은 정규분포 뿐만 아니라 수준별 표본들이 동일 분포를 따르는지를 검정하는데 사용할 수 있습니다.</p></div> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>여기선 statsmodels의 convenience method를 이용하였지만 scipy의 scipy.stats.kstest, scipy.stats.ks_2samp와 같은 메소드들을 사용할 수도 있습니다. 이 경우 정규분포를 fitting한 다음 cdf를 해당 메소드들의 argument롤 넘겨야 하는 등의 추가작업이 필요할 수 있습니다.</p></div> <h4 id="등분산성"><a href="#등분산성" aria-hidden="true" class="header-anchor">#</a> 등분산성</h4> <p>독립변수에 따른 종속변수는 각 수준별로 동일해야 한다는 조건(Homoscedasticity)입니다. 레빈(Levene) 검정을 이용하며, <a href="https://github.com/statsmodels/statsmodels/blob/fbd36d7aff99b7c516ddefdd8d333a84d4bcc535/statsmodels/stats/weightstats.py#L1103" target="_blank" rel="noopener noreferrer">statsmodels.stats.weightstats.test_equal_var<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 메소드를 지원할 예정이지만, 현재는 2d에 대한 weight 구현 문제로 scipy의 <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.levene.html" target="_blank" rel="noopener noreferrer">scipy.stats.levene<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 메소드를 사용해야 합니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>sp<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>levene<span class="token punctuation">(</span>drug<span class="token punctuation">,</span> placebo<span class="token punctuation">)</span>

<span class="token comment"># LeveneResult(statistic=4.542872436860705, pvalue=0.03587638864722)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="danger custom-block"><p class="custom-block-title">WARNING</p> <p>레빈 검정 결과 등분산성을 만족하지 못하며 따라서 최종적으로 독립표본 t-검정을 수행할 때 아래와 같이 uservar argument에 'unequal' 속성을 부여해야 합니다. 참고로 '크다' 또는 '작다'의 판단이 아닌 '다르다'를 판단해야 하기 때문에 양측검정을 해야 하고 따라서 alternative argument는 'two-sided'가 되어야 합니다.</p></div> <p>따라서 최종 독립표본 t-검정 코드는 아래와 같습니다. <a href="https://www.statsmodels.org/dev/generated/statsmodels.stats.weightstats.ttest_ind.html" target="_blank" rel="noopener noreferrer">statsmodels.stats.weightstats.ttest_ind<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>를 참고하시기 바랍니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># cf. Levene's test p-value &lt; 0.05, H0: Equal Variance rejected. usevar should be 'pooled'.</span>
sm<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>ttest_ind<span class="token punctuation">(</span>drug<span class="token punctuation">,</span> placebo<span class="token punctuation">,</span> alternative<span class="token operator">=</span><span class="token string">'two-sided'</span><span class="token punctuation">,</span> usevar<span class="token operator">=</span><span class="token string">'unequal'</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># (1.6221904572902277, 0.10975381983712841, 63.03889717357649)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>p-value가 0.1098로 어떤 기준을 따르느냐에(0.05? 0.10?) 따라 조금 애매하다면 애매할 수 있는 수치입니다.</p> <h3 id="대응표본-t-검정"><a href="#대응표본-t-검정" aria-hidden="true" class="header-anchor">#</a> 대응표본 t-검정</h3> <h4 id="정규성-검정"><a href="#정규성-검정" aria-hidden="true" class="header-anchor">#</a> 정규성 검정</h4> <p>정규성 검정은 위에서 말씀드린 독립표본 t-검정의 경우와 동일합니다.</p> <p>대응표본 t-검정의 경우 scipy의 <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_rel.html" target="_blank" rel="noopener noreferrer">scipy.stats.ttest_rel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 메소드를 사용하면 됩니다.</p> <h2 id="베이지안-t-검정"><a href="#베이지안-t-검정" aria-hidden="true" class="header-anchor">#</a> 베이지안 t-검정</h2> <h3 id="베이지안-데이터-분석"><a href="#베이지안-데이터-분석" aria-hidden="true" class="header-anchor">#</a> 베이지안 데이터 분석</h3> <p>베이지안 데이터 분석이 익숙하지 않으신 분들께는 <a href="/blog/bayesian_data_analysis_introduction.html">베이지안 데이터 분석</a> 포스팅에 소개한 세 개의 영상을 먼저 보실 것을 추천드립니다.</p> <h3 id="독립표본-t-검정-2"><a href="#독립표본-t-검정-2" aria-hidden="true" class="header-anchor">#</a> 독립표본 t-검정</h3> <p>기본 가정은 앞서 살펴본 내용과 동일하며, 아래 코드를 보시면 스튜던트 t-분포의 파라메터가 되는 group1과 group2의 평균, 표준편차, 그리고 v에 대한 사전분포(믿음)들과 이에 따른 결정론적 사항들에 대해 정의한 내용을 보실 수 있습니다.</p> <p>참고로 아래 코드의 작성자는 group1, group2 각각의 평균은 샘플 전체의 평균과 표준편차의 2배를 따르는 정규분포의 어딘가에 있을 것이라고 믿고 있고(정규분포이므로 봉우리 부분에 더 큰 믿음), 각각의 표준편차는 1부터 10까지 중 어딘가에 있을 것 같지만 그 중 어느 부분에 있을 확률이 더 높은지는 전혀 모르겠다고(균등분포) 믿고 있습니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>μ_m <span class="token operator">=</span> y<span class="token punctuation">.</span>value<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
μ_s <span class="token operator">=</span> y<span class="token punctuation">.</span>value<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>

σ_low <span class="token operator">=</span> <span class="token number">1</span>
σ_high <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">with</span> pm<span class="token punctuation">.</span>Model<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> model<span class="token punctuation">:</span>
    group1_mean <span class="token operator">=</span> pm<span class="token punctuation">.</span>Normal<span class="token punctuation">(</span><span class="token string">'group1_mean'</span><span class="token punctuation">,</span> μ_m<span class="token punctuation">,</span> sd<span class="token operator">=</span>μ_s<span class="token punctuation">)</span>
    group2_mean <span class="token operator">=</span> pm<span class="token punctuation">.</span>Normal<span class="token punctuation">(</span><span class="token string">'group2_mean'</span><span class="token punctuation">,</span> μ_m<span class="token punctuation">,</span> sd<span class="token operator">=</span>μ_s<span class="token punctuation">)</span>
    
    group1_std <span class="token operator">=</span> pm<span class="token punctuation">.</span>Uniform<span class="token punctuation">(</span><span class="token string">'group1_std'</span><span class="token punctuation">,</span> lower<span class="token operator">=</span>σ_low<span class="token punctuation">,</span> upper<span class="token operator">=</span>σ_high<span class="token punctuation">)</span>
    group2_std <span class="token operator">=</span> pm<span class="token punctuation">.</span>Uniform<span class="token punctuation">(</span><span class="token string">'group2_std'</span><span class="token punctuation">,</span> lower<span class="token operator">=</span>σ_low<span class="token punctuation">,</span> upper<span class="token operator">=</span>σ_high<span class="token punctuation">)</span>
    
    λ<span class="token number">1</span> <span class="token operator">=</span> group1_std<span class="token operator">**</span><span class="token operator">-</span><span class="token number">2</span>
    λ<span class="token number">2</span> <span class="token operator">=</span> group2_std<span class="token operator">**</span><span class="token operator">-</span><span class="token number">2</span>

    ν <span class="token operator">=</span> pm<span class="token punctuation">.</span>Exponential<span class="token punctuation">(</span><span class="token string">'ν_minus_one'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">29</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    
    diff_of_means <span class="token operator">=</span> pm<span class="token punctuation">.</span>Deterministic<span class="token punctuation">(</span><span class="token string">'difference of means'</span><span class="token punctuation">,</span> group1_mean <span class="token operator">-</span> group2_mean<span class="token punctuation">)</span>
    diff_of_stds <span class="token operator">=</span> pm<span class="token punctuation">.</span>Deterministic<span class="token punctuation">(</span><span class="token string">'difference of stds'</span><span class="token punctuation">,</span> group1_std <span class="token operator">-</span> group2_std<span class="token punctuation">)</span>
    effect_size <span class="token operator">=</span> pm<span class="token punctuation">.</span>Deterministic<span class="token punctuation">(</span><span class="token string">'effect size'</span><span class="token punctuation">,</span> diff_of_means <span class="token operator">/</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>group1_std<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> group2_std<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>그 다음 Likelihood를 정의합니다. 여기서 <a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo" target="_blank" rel="noopener noreferrer">MCMC(Markov Chain Monte Carlo)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 방법을 통해 사전분포를 업데이트 하게 됩니다. 단순화시켜 말씀드리면 y1, y2에서 각각 관측된 표본들이(observed=yn) group1, group2 각각의 파라미터들에 대한 사전 믿음을 바탕으로 모델링한 분포와(여기서는 스튜던트-t) 일관된다면 이를 Accept하고 아니라면 Reject하는 과정을 거치며 각자의 목표 확률분포를 근사하게 되는 것입니다.</p> <blockquote><p>...(constructing a Markov chain to do Monte Carlo approximation).</p></blockquote> <p>MCMC는 메트로폴리스-헤이스팅스, 깁스 샘플링 등의 랜덤워크 몬테카를로 알고리즘들을 사용합니다. 더 자세한 내용은 별도의 포스팅을 통해 다루어 보도록 하겠습니다. 다만 궁금하신 분들을 위해 차분하게 잘 설명된 자료를 남겨두자면 퀀토피안의 데이터 사이언티스트인 Thomas Wiecki의 <a href="http://twiecki.github.io/blog/2015/11/10/mcmc-sampling/" target="_blank" rel="noopener noreferrer">MCMC sampling for dummies<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>를 강력 추천드리고 싶습니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">with</span> model<span class="token punctuation">:</span>
    group1 <span class="token operator">=</span> pm<span class="token punctuation">.</span>StudentT<span class="token punctuation">(</span><span class="token string">'drug'</span><span class="token punctuation">,</span> mu<span class="token operator">=</span>group1_mean<span class="token punctuation">,</span> lam<span class="token operator">=</span>λ<span class="token number">1</span><span class="token punctuation">,</span> nu<span class="token operator">=</span>ν<span class="token punctuation">,</span> observed<span class="token operator">=</span>y1<span class="token punctuation">)</span>
    group2 <span class="token operator">=</span> pm<span class="token punctuation">.</span>StudentT<span class="token punctuation">(</span><span class="token string">'placebo'</span><span class="token punctuation">,</span> mu<span class="token operator">=</span>group2_mean<span class="token punctuation">,</span> lam<span class="token operator">=</span>λ<span class="token number">2</span><span class="token punctuation">,</span> nu<span class="token operator">=</span>ν<span class="token punctuation">,</span> observed<span class="token operator">=</span>y2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>이제 실제로 2000회의 샘플링을 수행합니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">with</span> model<span class="token punctuation">:</span>
    trace <span class="token operator">=</span> pm<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> cores<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>아래는 Deterministic으로 정의한 부분에 대한 결과입니다. 물론 group1_mean, group2_mean, group1_std, group2_std, v_minus_one도 varnames 부분을 바꿔주기만 하면 아래와 유사한 방법으로 확인이 가능합니다.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>pm<span class="token punctuation">.</span>plot_posterior<span class="token punctuation">(</span>trace<span class="token punctuation">,</span> varnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'difference of means'</span><span class="token punctuation">,</span><span class="token string">'difference of stds'</span><span class="token punctuation">,</span> <span class="token string">'effect size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  ref_val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                  color<span class="token operator">=</span><span class="token string">'#87ceeb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://docs.pymc.io/_images/notebooks_BEST_21_0.png" alt="posterior_deterministic"></p> <p>이제 우리는 경영진의 의문에 대해 이를 보다 효과적으로 설명하고, 쉽게 이해시키며, 어쩌면 설득 할 수도 있습니다. p-value가 뭔지도 모르는 사람에게 단순히 p-value가 얼마 이하라서 다르다, test 결과가 그렇다고 말 하는 것 보다, estimation의 결과를 보여주면서 우리의 사전 믿음이 어떠했고 사후 믿음은 얼마나 달라졌는지에 대한 정보도 함께 제공할 수 있는 보다 informative한 기법이기 때문입니다(인식론적 불확실성과 무작위적 불확실성의 구분).</p> <div class="tip custom-block"><p class="custom-block-title">Why</p> <p><a href="https://docs.pymc.io/notebooks/BEST.html" target="_blank" rel="noopener noreferrer">https://docs.pymc.io/notebooks/BEST.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>A more informative and effective approach for comparing groups is one based on estimation rather than testing, and is driven by Bayesian probability rather than frequentist. That is, rather than testing whether two groups are different, we instead pursue an estimate of how different they are, which is fundamentally more informative. Moreover, we include an estimate of uncertainty associated with that difference which includes uncertainty due to our lack of knowledge of the model parameters (epistemic uncertainty) and uncertainty due to the inherent stochasticity of the system (aleatory uncertainty).</p></div></div></div></div></div> <footer class="v-footer mt-0 theme--light" style="height:64px;background-color:#EEEEEE;border-color:#EEEEEE;" data-v-593c3a53><div class="layout justify-center" data-v-593c3a53><div class="caption grey--text" data-v-593c3a53>Powered by Vue.js(Vuepress + Vuetify)</div></div></footer></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cbae415f.js" defer></script><script src="/assets/js/3.aaca8d00.js" defer></script><script src="/assets/js/22.e4efa8b6.js" defer></script>
  </body>
</html>
